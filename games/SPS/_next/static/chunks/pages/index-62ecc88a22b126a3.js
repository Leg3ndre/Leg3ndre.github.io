(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{993:e=>{e.exports={gamePrepare:"gamePrepare_gamePrepare__FLX7J",gamePrepareHeader:"gamePrepare_gamePrepareHeader__Kqnj5",gamePrepareKeys:"gamePrepare_gamePrepareKeys__Edd8y"}},2082:e=>{e.exports={version:"gameVersion_version__v7Ulq",currentVersion:"gameVersion_currentVersion__4gcAt"}},2366:e=>{e.exports={bgm:"bgmAudio_bgm__3Ys8j",bgmDesc:"bgmAudio_bgmDesc__dlJyd",composer:"bgmAudio_composer__RI_3P"}},3259:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>W});var i=s(7876),r=s(5855),n=s.n(r),a=s(4232),o=s(3273),h=s.n(o);let l=()=>(0,i.jsxs)("div",{className:h().desc,children:[(0,i.jsxs)("p",{className:h().abstract,children:["FPS（一人称視点）、TPS（三人称視点）に支配された現代のシューティングゲーム界隈に一石を投じる",(0,i.jsx)("strong",{children:"二人称視点のシューティングゲーム"}),"です。"]}),(0,i.jsxs)("ul",{className:h().playManual,children:[(0,i.jsxs)("li",{children:["ゲームは",(0,i.jsx)("strong",{children:"敵視点"}),"で進行します"]}),(0,i.jsx)("li",{children:"プレイヤーが操作するのは画面奥の黄色いキャラクター（Mr.K）です"}),(0,i.jsx)("li",{children:"三角形の物体が弾です（赤: 自分の弾、緑: 敵の弾）。弾は同時に5発までしか撃てません"}),(0,i.jsx)("li",{children:"敵の弾を避け、自分の弾を敵にうまく当ててください"}),(0,i.jsxs)("li",{children:["操作方法",(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:"→ or D: 右へ移動"}),(0,i.jsx)("li",{children:"← or A: 左へ移動"}),(0,i.jsx)("li",{children:"↑ or W: 弾を発射"}),(0,i.jsx)("li",{children:"R: リトライ"})]})]})]})]});var c=s(9120),d=s.n(c),u=s(6366),m=s.n(u);let y=e=>{let{playerLife:t,enemyLife:s,setOnGame:r}=e,n=(0,a.useRef)(null);return(0,a.useEffect)(()=>{t>0&&s>0||(r(!1),n.current.style.display="block")},[t,s]),(0,i.jsx)("div",{id:"gameOver",className:m().gameOver,ref:n,children:(0,i.jsx)("div",{className:m().gameOverHeader,children:t<=0?"You Lose...":"You win!!"})})};var p=s(993),x=s.n(p);let f=e=>{let{setOnGame:t}=e,s=(0,a.useRef)(null),r=(0,a.useRef)(!1);(0,a.useEffect)(()=>(document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}),[]);let n=e=>{r.current||("a"==e.key||"d"==e.key||"w"==e.key||"ArrowLeft"==e.key||"ArrowRight"==e.key||"ArrowUp"==e.key)&&(r.current=!0,t(!0),s.current.style.display="none")};return(0,i.jsx)("div",{id:"gamePrepare",className:x().gamePrepare,children:(0,i.jsxs)("div",{className:x().gamePrepareHeader,ref:s,children:["Press",(0,i.jsx)("img",{src:"./arrows.png",className:x().gamePrepareKeys}),"or",(0,i.jsx)("img",{src:"./wasd.png",className:x().gamePrepareKeys}),(0,i.jsx)("br",{}),"to start."]})})},g=e=>{let t=(0,a.useRef)(0),s=(0,a.useRef)(0),i=(0,a.useCallback)(()=>{t.current=requestAnimationFrame(i);let r=Date.now();r-s.current+1<16.666666666666668||(s.current=r,e())},[e]);(0,a.useEffect)(()=>(t.current=requestAnimationFrame(i),()=>cancelAnimationFrame(t.current)),[i])},v=()=>{let e=(0,a.useRef)({});(0,a.useEffect)(()=>(document.addEventListener("keydown",t),document.addEventListener("keyup",s),()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",s)}),[]);let t=t=>{e.current[t.key]=!0},s=t=>{delete e.current[t.key]};return e.current},w=(e,t)=>{let s=k(t),i=_(e,t);return{x:(e.x-s.x)*i+320,y:(e.y-s.y)*i+240}},_=(e,t)=>{let s=k(t);return-s.z/(e.z-s.z)},k=e=>({x:e,y:0,z:-100}),z=function(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"white",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,t.y),e.lineTo(s.x,s.y),e.lineTo(t.x,s.y),e.lineTo(t.x,t.y),e.strokeStyle=i,e.lineWidth=r,e.stroke()},j=function(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"yellow",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,s.y),e.strokeStyle=i,e.lineWidth=r,e.stroke()},L=(e,t,s,i,r)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,s.y),e.lineTo(i.x,i.y),e.lineTo(t.x,t.y),e.strokeStyle=r,e.lineWidth=1,e.stroke()},A=50;class E{draw(e,t){for(let s=0;s<=16;s++){let[i,r]=[{x:-400+A*s,y:20,z:-90},{x:-400+A*s,y:20,z:100}].map(e=>w(e,t));j(e,i,r)}for(let s=0;s<=6;s++){let[i,r]=[{x:-400,y:20,z:-90+31.666666666666668*s},{x:400,y:20,z:-90+31.666666666666668*s}].map(e=>w(e,t));j(e,i,r)}}}class P{tick(){this.z-=(1==this.side?1:-1)*this.velocityZ,this.updateAlive()}updateAlive(){1==this.side?this.z<=-90&&(this.isAlive=!1):this.z>=90&&(this.isAlive=!1)}draw(e,t){let s,i,r,n;this.isAlive&&(1==this.side?([s,i,r]=this.buildPlayerShot(t),n="red"):([s,i,r]=this.buildEnemyShot(t),n="lime"),L(e,s,i,r,n))}buildPlayerShot(e){let t={x:this.x,y:13.4,z:this.z-5};return[t,{x:this.x+3.5,y:6.6000000000000005,z:this.z+3.5},{x:this.x-3.5,y:6.6000000000000005,z:this.z+3.5}].map(t=>w(t,e))}buildEnemyShot(e){let t={x:this.x,y:13.4,z:this.z+5};return[t,{x:this.x+3.5,y:6.6000000000000005,z:this.z-3.5},{x:this.x-3.5,y:6.6000000000000005,z:this.z-3.5}].map(t=>w(t,e))}hits(e){return 1==this.side?9>this.distance(e,-90,this.x,this.z):9>this.distance(e,90,this.x,this.z)}distance(e,t,s,i){return Math.sqrt(Math.pow(e-s,2)+Math.pow(t-i,2))}constructor(e,t){this.velocityZ=1,this.isAlive=!0,this.x=e,this.side=t,this.z=1==this.side?90:-90}}class b{drawShots(e,t){for(let s of this.shotList)s.draw(e,t)}updatePositionAndVelocity(){this.isInMovableRange()?this.position+=this.velocity:this.velocity=0,this.velocity*=.995}updateShots(){for(let e of this.shotList)e.tick();this.shotList=this.shotList.filter(e=>e.isAlive),this.shotWait>0&&this.shotWait--}updateLifeAndFreeze(e,t){this.freeze>0&&this.freeze--,this.isAttacked(e)&&(t&&this.life--,this.freeze=120)}shoot(){if(!this.canShot())return;let e=new P(this.position,this.side);this.shotList.push(e),this.shotWait=15}canShot(){return this.shotList.length<5&&this.shotWait<=0}isInMovableRange(){return this.position+this.velocity<=400&&this.position+this.velocity>=-400}isAttacked(e){if(this.freeze>0)return!1;for(let t of e)if(t.hits(this.position))return!0;return!1}constructor(){this.life=5,this.position=0,this.velocity=0,this.shotList=[],this.shotWait=0,this.freeze=0,this.side=0}}let N=b;class S extends N{draw(e,t){let s={x:this.position-this.image.width/2,y:0+(20-this.image.height),z:100},i=w(s,t),r=_(s,t);e.drawImage(this.image,i.x,i.y,this.image.width*r,this.image.height*r),this.drawShots(e,t),this.freeze>0&&this.drawFreezed(e,t)}tick(e,t,s){this.handleKeyPressed(e),this.processActQueue(),this.updatePositionAndVelocity(),this.updateShots(),this.updateLifeAndFreeze(t,s)}handleKeyPressed(e){e.a||e.ArrowLeft?this.actQueue.push("l"):e.d||e.ArrowRight?this.actQueue.push("r"):this.actQueue.push("n"),(e.w||e.ArrowUp)&&(this.actQueue[18]+="s")}processActQueue(){if(this.actQueue.length<=18)return;let e=this.actQueue.shift();void 0!=e&&!(this.freeze>0)&&(/l/.test(e)?this.velocity+=.1:/r/.test(e)&&(this.velocity-=.1),/s/.test(e)&&this.shoot())}drawFreezed(e,t){let s=[50*(1-Math.pow(this.freeze/120,5)),50*(1-Math.pow((this.freeze-20)/120,5))];for(let i=0;i<2;i++){let r=0+(20-this.image.height/2),[n,a]=[{x:this.position-s[i]/2,y:r-s[i]/2,z:100},{x:this.position+s[i]/2,y:r+s[i]/2,z:100}].map(e=>w(e,t));z(e,n,a,"white",1)}}constructor(){super(),this.side=1,this.actQueue=[],this.image=new Image,this.image.src="./player.png"}}class R extends N{draw(e){this.drawShots(e,this.position),this.freeze>0&&this.drawFreezed(e)}tick(e,t,s){this.actAI(e),this.updatePositionAndVelocity(),this.updateShots(),this.updateLifeAndFreeze(t,s)}actAI(e){!(this.freeze>0)&&(this.velocity+=1==this.direction?.1:-.1,100*Math.random()<150*this.direction*Math.pow((this.position-e)/100,3)&&(this.direction*=-1),100*Math.random()<10&&this.shoot())}drawFreezed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;for(let s=0;s<70/t;s++){let i=Math.max(1-Math.pow((this.freeze+s*t)/120,5),0);z(e,{x:-(320*i)+320,y:-(240*i)+240},{x:320*i+320,y:240*i+240},"white",5)}}constructor(){super(),this.side=0,this.direction=0,this.direction=10*Math.random()<5?-1:1}}let M=e=>{let{setPlayerLife:t,setEnemyLife:s}=e,r=(0,a.useRef)(null),n=v(),o=(0,a.useRef)(new E),h=(0,a.useRef)(null),l=(0,a.useRef)(new R),[c,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{document.body.addEventListener("keydown",e=>e.preventDefault())},[]),(0,a.useEffect)(()=>{h.current=new S},[]),g(()=>{let e=r.current.getContext("2d");null!=e&&null!=h.current&&(e.clearRect(0,0,640,480),o.current.draw(e,l.current.position),h.current.draw(e,l.current.position),l.current.draw(e),h.current.tick(n,l.current.shotList,c),c&&t(h.current.life),l.current.tick(h.current.position,h.current.shotList,c),c&&s(l.current.life))});let m=h.current?h.current.life:5;return(0,i.jsxs)("div",{className:d().gameContainer,children:[(0,i.jsx)("canvas",{id:"game",width:640,height:480,className:d().gameCanvas,ref:r}),(0,i.jsx)(f,{setOnGame:u}),(0,i.jsx)(y,{playerLife:m,enemyLife:l.current.life,setOnGame:u})]})},F=()=>{(0,a.useEffect)(()=>(document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}),[]);let e=e=>{"r"==e.key&&t()},t=()=>{let e=document.getElementById("bgm");sessionStorage.setItem("audioVolume",e.volume.toString()),location.reload()};return(0,i.jsx)("a",{href:"#",onClick:()=>t(),children:"Retry"})};var T=s(2366),C=s.n(T);let O=()=>{let e=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(null==e.current)return;let t=sessionStorage.getItem("audioVolume");e.current.volume=null==t?.4:parseFloat(t)},[]),(0,a.useEffect)(()=>(document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}),[]);let t=t=>{null!=e.current&&("a"==t.key||"d"==t.key||"w"==t.key||"ArrowLeft"==t.key||"ArrowRight"==t.key||"ArrowUp"==t.key)&&e.current.play()};return(0,i.jsxs)("div",{className:C().bgm,children:[(0,i.jsx)("audio",{id:"bgm",src:"./bgm.mp3",ref:e,controls:!0,autoPlay:!0,loop:!0,children:(0,i.jsx)("p",{children:"お使いのブラウザでは再生できません"})}),(0,i.jsxs)("span",{className:C().bgmDesc,children:["BGM: ",(0,i.jsx)("b",{children:"Look at me!!"})," - ",(0,i.jsxs)("span",{className:C().composer,children:["by ","Mr.O"]})]})]})};var I=s(2082),Q=s.n(I);let V=()=>(0,i.jsx)("div",{className:Q().version,children:(0,i.jsx)("code",{className:Q().currentVersion,children:"v1.0.8"})});function W(){let[e,t]=(0,a.useState)(5),[s,r]=(0,a.useState)(5);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h1",{className:n().title,children:"Second Person Shooting"}),(0,i.jsxs)("div",{className:n().scores,children:[(0,i.jsxs)("span",{id:"pl-life",className:n().plLife,children:["PLAYER'S LIFE: ",e]}),(0,i.jsxs)("span",{id:"en-life",className:n().enLife,children:["ENEMY'S LIFE: ",s]})]}),(0,i.jsx)(M,{setPlayerLife:t,setEnemyLife:r}),(0,i.jsx)(F,{}),(0,i.jsx)(O,{}),(0,i.jsx)(l,{}),(0,i.jsx)(V,{})]})}},3273:()=>{},5855:e=>{e.exports={scores:"index_scores__c1eQ3",plLife:"index_plLife__d9eAk",enLife:"index_enLife__ddbTC"}},6366:e=>{e.exports={gameOver:"gameOver_gameOver__r7lTb",gameOverHeader:"gameOver_gameOverHeader__NhecN"}},6760:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(3259)}])},9120:e=>{e.exports={gameContainer:"gameCanvas_gameContainer__8khmy",gameCanvas:"gameCanvas_gameCanvas__v5Dar"}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(6760)),_N_E=e.O()}]);