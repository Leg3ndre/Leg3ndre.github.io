(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2366:e=>{e.exports={bgm:"bgmAudio_bgm__3Ys8j",bgmDesc:"bgmAudio_bgmDesc__dlJyd",composer:"bgmAudio_composer__RI_3P"}},3273:()=>{},5855:e=>{e.exports={scores:"index_scores__c1eQ3",plLife:"index_plLife__d9eAk",enLife:"index_enLife__ddbTC"}},6760:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(9358)}])},9120:e=>{e.exports={gameCanvas:"gameCanvas_gameCanvas__v5Dar"}},9358:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>N});var s=i(7876),r=i(5855),n=i.n(r),h=i(4232),o=i(3273),l=i.n(o);let a=()=>(0,s.jsxs)("div",{className:l().desc,children:[(0,s.jsxs)("p",{className:l().abstract,children:["FPS（一人称視点）、TPS（三人称視点）に支配された現代のシューティングゲーム界隈に一石を投じる",(0,s.jsx)("strong",{children:"二人称視点のシューティングゲーム"}),"です。"]}),(0,s.jsxs)("ul",{className:l().playManual,children:[(0,s.jsxs)("li",{children:["ゲームは",(0,s.jsx)("strong",{children:"敵視点"}),"で進行します"]}),(0,s.jsx)("li",{children:"プレイヤーが操作するのは画面奥の黄色いキャラクター（Mr.K）です"}),(0,s.jsx)("li",{children:"三角形の物体が弾です（赤: 自分の弾、緑: 敵の弾）。弾は同時に5発までしか撃てません"}),(0,s.jsx)("li",{children:"敵の弾を避け、自分の弾を敵にうまく当ててください"}),(0,s.jsx)("li",{children:"※ 現状では敵のライフを0にしてもゲームは終了しません"}),(0,s.jsxs)("li",{children:["操作方法",(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"→ or D: 右へ移動"}),(0,s.jsx)("li",{children:"← or A: 左へ移動"}),(0,s.jsx)("li",{children:"↑ or W: 弾を発射"}),(0,s.jsx)("li",{children:"R: リトライ"})]})]})]})]});var c=i(9120),d=i.n(c);let u=e=>{let t=(0,h.useRef)(0),i=(0,h.useRef)(0),s=(0,h.useCallback)(()=>{t.current=requestAnimationFrame(s);let r=Date.now();r-i.current<16.666666666666668||(i.current=r,e())},[e]);(0,h.useEffect)(()=>(t.current=requestAnimationFrame(s),()=>cancelAnimationFrame(t.current)),[s])},m=()=>{let e=(0,h.useRef)({});(0,h.useEffect)(()=>(document.addEventListener("keydown",t),document.addEventListener("keyup",i),()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",i)}),[]);let t=t=>{e.current[t.key]=!0},i=t=>{delete e.current[t.key]};return e.current},x=(e,t)=>{let i=f(t),s=y(e,t);return{x:(e.x-i.x)*s+320,y:(e.y-i.y)*s+240}},y=(e,t)=>{let i=f(t);return-i.z/(e.z-i.z)},f=e=>({x:e,y:0,z:-100}),p=function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"white",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,t.y),e.lineTo(i.x,i.y),e.lineTo(t.x,i.y),e.lineTo(t.x,t.y),e.strokeStyle=s,e.lineWidth=r,e.stroke()},g=function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"yellow",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.strokeStyle=s,e.lineWidth=r,e.stroke()},v=(e,t,i,s,r)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(s.x,s.y),e.lineTo(t.x,t.y),e.strokeStyle=r,e.lineWidth=1,e.stroke()},w=50;class z{draw(e,t){for(let i=0;i<=16;i++){let[s,r]=[{x:-400+w*i,y:20,z:-90},{x:-400+w*i,y:20,z:100}].map(e=>x(e,t));g(e,s,r)}for(let i=0;i<=6;i++){let[s,r]=[{x:-400,y:20,z:-90+31.666666666666668*i},{x:400,y:20,z:-90+31.666666666666668*i}].map(e=>x(e,t));g(e,s,r)}}}class k{tick(){this.z-=(1==this.side?1:-1)*this.velocityZ,this.updateAlive()}updateAlive(){1==this.side?this.z<=-90&&(this.isAlive=!1):this.z>=90&&(this.isAlive=!1)}draw(e,t){let i,s,r,n;this.isAlive&&(1==this.side?([i,s,r]=this.buildPlayerShot(t),n="red"):([i,s,r]=this.buildEnemyShot(t),n="lime"),v(e,i,s,r,n))}buildPlayerShot(e){let t={x:this.x,y:13.4,z:this.z-5};return[t,{x:this.x+3.5,y:6.6000000000000005,z:this.z+3.5},{x:this.x-3.5,y:6.6000000000000005,z:this.z+3.5}].map(t=>x(t,e))}buildEnemyShot(e){let t={x:this.x,y:13.4,z:this.z+5};return[t,{x:this.x+3.5,y:6.6000000000000005,z:this.z-3.5},{x:this.x-3.5,y:6.6000000000000005,z:this.z-3.5}].map(t=>x(t,e))}hits(e){return 1==this.side?9>this.distance(e,-90,this.x,this.z):9>this.distance(e,90,this.x,this.z)}distance(e,t,i,s){return Math.sqrt(Math.pow(e-i,2)+Math.pow(t-s,2))}constructor(e,t){this.velocityZ=1,this.isAlive=!0,this.x=e,this.side=t,this.z=1==this.side?90:-90}}class j{drawShots(e,t){for(let i of this.shotList)i.draw(e,t)}updatePositionAndVelocity(){this.isInMovableRange()?this.position+=this.velocity:this.velocity=0,this.velocity*=.995}updateShots(){for(let e of this.shotList)e.tick();this.shotList=this.shotList.filter(e=>e.isAlive),this.shotWait>0&&this.shotWait--}updateLifeAndFreeze(e){this.freeze>0&&this.freeze--,this.isAttacked(e)&&(this.life--,this.freeze=120)}shoot(){if(!this.canShot())return;let e=new k(this.position,this.side);this.shotList.push(e),this.shotWait=15}canShot(){return this.shotList.length<5&&this.shotWait<=0}isInMovableRange(){return this.position+this.velocity<=400&&this.position+this.velocity>=-400}isAttacked(e){if(this.freeze>0)return!1;for(let t of e)if(t.hits(this.position))return!0;return!1}constructor(){this.life=5,this.position=0,this.velocity=0,this.shotList=[],this.shotWait=0,this.freeze=0,this.side=0}}let L=j;class _ extends L{draw(e,t){let i={x:this.position-this.image.width/2,y:0+(20-this.image.height),z:100},s=x(i,t),r=y(i,t);e.drawImage(this.image,s.x,s.y,this.image.width*r,this.image.height*r),this.drawShots(e,t),this.freeze>0&&this.drawFreezed(e,t)}tick(e,t){this.handleKeyPressed(e),this.processActQueue(),this.updatePositionAndVelocity(),this.updateShots(),this.updateLifeAndFreeze(t)}handleKeyPressed(e){e.a||e.ArrowLeft?this.actQueue.push("l"):e.d||e.ArrowRight?this.actQueue.push("r"):this.actQueue.push("n"),(e.w||e.ArrowUp)&&(this.actQueue[18]+="s")}processActQueue(){if(this.actQueue.length<=18)return;let e=this.actQueue.shift();void 0!=e&&!(this.freeze>0)&&(/l/.test(e)?this.velocity+=.1:/r/.test(e)&&(this.velocity-=.1),/s/.test(e)&&this.shoot())}drawFreezed(e,t){let i=[50*(1-Math.pow(this.freeze/120,5)),50*(1-Math.pow((this.freeze-20)/120,5))];for(let s=0;s<2;s++){let r=0+(20-this.image.height/2),[n,h]=[{x:this.position-i[s]/2,y:r-i[s]/2,z:100},{x:this.position+i[s]/2,y:r+i[s]/2,z:100}].map(e=>x(e,t));p(e,n,h,"white",1)}}constructor(){super(),this.side=1,this.actQueue=[],this.image=new Image,this.image.src="/player.png"}}class A extends L{draw(e){this.drawShots(e,this.position),this.freeze>0&&this.drawFreezed(e)}tick(e,t){this.actAI(e),this.updatePositionAndVelocity(),this.updateShots(),this.updateLifeAndFreeze(t)}actAI(e){!(this.freeze>0)&&(this.velocity+=1==this.direction?.1:-.1,100*Math.random()<150*this.direction*Math.pow((this.position-e)/100,3)&&(this.direction*=-1),100*Math.random()<10&&this.shoot())}drawFreezed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;for(let i=0;i<70/t;i++){let s=Math.max(1-Math.pow((this.freeze+i*t)/120,5),0);p(e,{x:-(320*s)+320,y:-(240*s)+240},{x:320*s+320,y:240*s+240},"white",5)}}constructor(){super(),this.side=0,this.direction=0,this.direction=10*Math.random()<5?-1:1}}let E=e=>{let{setPlayerLife:t,setEnemyLife:i}=e,r=(0,h.useRef)(null),n=m(),o=(0,h.useRef)(new z),l=(0,h.useRef)(null),a=(0,h.useRef)(new A);return(0,h.useEffect)(()=>{document.body.addEventListener("keydown",e=>e.preventDefault())},[]),(0,h.useEffect)(()=>{let e=document.getElementById("game");e&&e.getContext&&(r.current=e.getContext("2d"))},[]),(0,h.useEffect)(()=>{l.current=new _},[]),u(()=>{null!=r.current&&null!=l.current&&(r.current.clearRect(0,0,640,480),o.current.draw(r.current,a.current.position),l.current.draw(r.current,a.current.position),a.current.draw(r.current),l.current.tick(n,a.current.shotList),t(l.current.life),a.current.tick(l.current.position,l.current.shotList),i(a.current.life))}),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("canvas",{id:"game",width:640,height:480,className:d().gameCanvas})})},b=()=>{(0,h.useEffect)(()=>(document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}),[]);let e=e=>{"r"==e.key&&location.reload()};return(0,s.jsx)("a",{href:"#",onClick:()=>location.reload(),children:"Retry"})};var S=i(2366),P=i.n(S);let M=()=>{(0,h.useEffect)(()=>(document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}),[]);let e=e=>{("a"==e.key||"d"==e.key||"ArrowLeft"==e.key||"ArrowRight"==e.key)&&document.getElementById("bgm").play()};return(0,s.jsxs)("div",{className:P().bgm,children:[(0,s.jsx)("audio",{id:"bgm",src:"./bgm.mp3",controls:!0,autoPlay:!0,loop:!0,children:(0,s.jsx)("p",{children:"お使いのブラウザでは再生できません"})}),(0,s.jsxs)("span",{className:P().bgmDesc,children:["BGM: ",(0,s.jsx)("b",{children:"Look at me!!"})," - ",(0,s.jsxs)("span",{className:P().composer,children:["by ","Mr.O"]})]})]})};function N(){let[e,t]=(0,h.useState)(5),[i,r]=(0,h.useState)(5);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:n().title,children:"Second Person Shooting"}),(0,s.jsxs)("div",{className:n().scores,children:[(0,s.jsxs)("span",{id:"pl-life",className:n().plLife,children:["PLAYER'S LIFE: ",e]}),(0,s.jsxs)("span",{id:"en-life",className:n().enLife,children:["ENEMY'S LIFE: ",i]})]}),(0,s.jsx)(E,{setPlayerLife:t,setEnemyLife:r}),(0,s.jsx)(b,{}),(0,s.jsx)(M,{}),(0,s.jsx)(a,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(6760)),_N_E=e.O()}]);